---
title: "Cleaning NCDC Storm Events"
author: "Tim Trice"
output:
  html_document:
    fig_caption: yes
    highlight: kate
    keep_md: yes
    theme: journal
---


```{r knitr-setup}
knitr::opts_chunk$set(
 fig.align = "center",
 fig.path = "figures/", 
 cache.path = "cache/", 
 cache = FALSE
)
```

```{r libraries}
library(data.table)
library(lubridate)
library(knitr)
library(tidyr)
```

```{r sessionInfo}
sessionInfo()
```

## Details

```{r details, cache=TRUE}
details <- fread("data/details.csv")
```

```{r details-str}
dim(details)

colnames(details)

str(details)
```

### Dates and Times

I look first on concatenating `BEGIN_YEARMONTH`, `BEGIN_DAY`, `BEGIN_TIME` and `END_YEARMONTH`, `END_DAY`, `END_TIME`. These should be only two variables. Scrolling further down the names there is already a `BEGIN_DATE_TIME` and `END_DATE_TIME` variable.

I'll look first at making sure the beginning time periods match.

```{r details-begin-datetime}
x <- details[1:10, .(BEGIN_YEARMONTH, BEGIN_DAY, BEGIN_TIME, BEGIN_DATE_TIME)]
kable(x)
```

They do line up so I know I can drop `BEGIN_YEARMONTH`, `BEGIN_DAY` and `BEGIN_TIME`.

What about the end times?

```{r details-end-datetime}
x <- details[1:10, .(END_YEARMONTH, END_DAY, END_TIME, END_DATE_TIME)]
kable(x)
```

These are lined up as well. 

I'll rebuild `details` minus `BEGIN_YEARMONTH`, `BEGIN_DAY`, `BEGIN_TIME`, `END_YEARMONTH`, `END_DAY`, `END_TIME`.

```{r details-rebuild}
details <- details[, c("BEGIN_YEARMONTH", 
                       "BEGIN_DAY", 
                       "BEGIN_TIME", 
                       "END_YEARMONTH", 
                       "END_DAY", 
                       "END_TIME") := NULL]

dim(details)
```

### EPISODE_ID

`EPISODE_ID` is the key linking `details` to `locations`. Not all events have `EPISODE_ID`

```{r episode_id}
summary(details$EPISODE_ID)
```

### EVENT_ID

`EVENT_ID` links the events across the three datasets and can be used as a *PRIMARY KEY*.

```{r event_id}
summary(details$EVENT_ID)
```

### STATE

`STATE` is listed in it's full name, all caps. I'll first get a list of unique `STATE`'s. 

```{r unique-states}
unique_states <- unique(details$STATE)
print(sort(unique_states))
```

We have one empty entry which I will convert to `NA` for the time being. There are also generic entries such as *ATLANTIC NORTH* and *ATLANTIC SOUTH* which I suspect are for hurricane activity. 

For the moment, I will not make any additional changes other than the empty strings to `NA`.

```{r details-states-na}
setkey(details, STATE)
details["", STATE := NA]

# Check again
unique_states <- unique(details$STATE)
print(sort(unique_states))
sum(is.na(details$STATE))
```


## Fatalities

## Locations

